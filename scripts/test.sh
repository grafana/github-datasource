# runs inside the container so screenshots match
echo "running"

export GRAFANA_LICENSE_KEY=eyJhbGciOiJSUzUxMiIsInR5cCI6IkpXVCIsImtpZCI6IjEifQ.eyJpc3MiOiJodHRwczovL2dyYWZhbmEuY29tIiwic3ViIjoiaHR0cDovL2xvY2FsaG9zdDozMDAwLyIsImp0aSI6IjgwNSIsIm5iZiI6MTU3ODU3NjUyNiwiaWF0IjoxNTc4NTc2NzgyLCJleHAiOjE2MTA5NzY0OTAsImxleHAiOjE2MTA5NzY0OTAsImxpZCI6IjEwNTAwIiwicHJvZCI6WyJncmFmYW5hLWVudGVycHJpc2UiXSwibWF4X3VzZXJzIjotMSwiY29tcGFueSI6IkdyYWZhbmEgTGFicyJ9.ZVEJSdj1FiQ15AlQvJzzDr-1IrT2cHmve9fSTkMYNo1vXBIdKAOFrggv3cYp1ev_FpRsJvGbCLXS0IsDIKushoEy_xd50vUSn_EO2gRZwDaZ-6ZCyWWmN4rMe1CgVI_oKEtQysjhwUDrOpDhRcl3BvjShoWxJzVL84SOnLw3VWuFKljS6fKlusx1C86Dw0Kq8RQQvi9xLyNl-_zVDNZy6UYNYSP-wstA4B1DxwwUWdcvBe1326aTD8aKbofSGY-16W6Ou_KSRDCQRSvLotsY6VkZCgXGVzgLqFQK7a74eEl2mMnkdRb8325NjrBh6uMVBVVCEoyGEBKvgHMqhyAc1qHGfpy8s9emd1UFVrF-RJmUjeUta_VT6vDAtPv1a7IPpkhrG2DsVnLivk_BOcwq3UuJP1ZxrUb_HkSvkqWAz7vT1bgk_i7noURfJz6GVDKviXLNAYm40QfMqIbSAClHiH1UmcYU53M1-Xy0bY2d40YPWH75f_ZVfTstaa9BoEK6YemCj9J2ezpBjuUFjGkTK9LFrnTb_MO3JZMrwNPl5Vu4hcGzPg80_6uFMymgt2SGKcPyErB3790DTcssSfWY01Uegt3PJT6IgE91fkcfM0TU_kukR3c_0OpTtuYm3MKaxrMv4UGV-sz6_jimi7HQOhVY-PgE6-0ZsU_vvmpOY-0

cd ./home

$(npm bin)/cypress install

echo "starting tests"

export CYPRESS_HOST=host.docker.internal
export CYPRESS_BASE_URL=http://host.docker.internal:3000

yarn e2e:update

# this will simulate how it runs on ci
# wget -O grabpl https://grafana-downloads.storage.googleapis.com/grafana-build-pipeline/v0.5.40/grabpl
# chmod +x grabpl
# ./grabpl plugin e2etests